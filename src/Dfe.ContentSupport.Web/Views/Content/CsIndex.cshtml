@model CsPage

@{
    Layout = "_CsLayout";
}

<div class="govuk-grid-row">

    @if (Model.MenuItems is not null)
    {
        <div class="govuk-grid-column-one-quarter sticky">
            <nav class="dfe-vertical-nav">
                <div class="dfe-vertical-nav__section">
                    <ul class="dfe-vertical-nav__section">
                        @foreach (var menuItem in Model.MenuItems)
                        {
                            <li class="dfe-vertical-nav__section-item">
                                <a class="dfe-vertical-nav__link @(menuItem.IsActive ? "dfe-vertical-nav__section-item--current" : "")" href="@menuItem.Url">@(string.IsNullOrEmpty(menuItem.Subtitle) ? "" : $"{menuItem.Subtitle} : ") @menuItem.Title </a>
                            </li>
                        }
                    </ul>
                </div>
            </nav>
        </div>
    }

    <div class="govuk-grid-column-three-quarters">

        @foreach (var content in Model.Content)
        {
            <partial name="_Content" model="@content"/>
        }
    
        @if (Model.HasCitation)
        {
            <partial name="_Citation" model="Model"/>
        }

        @if (Model.HasBackToTop)
        {
            <partial name="_BackToTop"/>
        }

        @if (Model.HasPrint)
        {
            <partial name="_Print"/>
        }
        
        @if (Model.HasFeedbackBanner)
        {
            <partial name="_Feedback" />
        }
    </div>
</div>

@section BodyEnd{
    @if (Model.HasPrint)
    {
        <script nonce="@Context.Items["nonce"]" defer>
            /**
            * Adds functionality for printing a page to the Print Page button (_Print.cshtml)
            */
            const printPage = () => window.print();


            const addPrintButtonEventListener = () => {
                const printButton = document.getElementById("print-link");

                if(!printButton){
                    return;
                }

                printButton.addEventListener('click', printPage);
            }

            addPrintButtonEventListener();
        </script>
    }

    <script nonce="@Context.Items["nonce"]" defer>
        const hiddenClass = "govuk-visually-hidden";

        //Some elements should remain hidden
        const idsToNotShow = ["support-links"];

        //Remove hidden visibility CSS class if JS enabled
        const removeHiddenClassFromElements = () => {
            const hiddenElements = Array.from(document.querySelectorAll(`.${hiddenClass}`));

            for(const element of hiddenElements){
                if(idsToNotShow.indexOf(element.id) > -1){
                    continue;
                }

                element.classList.remove(hiddenClass);
                //Also unset "aria-hidden" attribute
                element.ariaHidden = undefined;
            }
        }

        removeHiddenClassFromElements();
    </script>
}